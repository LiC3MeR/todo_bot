<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
body {
      background-color: black;
      color: #ffff;
}
 button {
    border-radius: 10px;
    color:red ;
    transition: .2s linear;
    background: #ffff;
}

button:hover {
    box-shadow: 0 0 0 2px white, 0 0 0 4px #3C82F8;
}
        

</style>
</head>
<body>

<!-- start header -->
<div id="pageHeader">
  <div id="title">Smoke big dick</div>
  <!-- navigation -->
  <div class="navigation">
      <button>reg</button>
      <button>About</button>
      <button>Instructors</button>
      <button>Testimonials</button>
      <button onclick="sendRequest()">Слить правки</button>

  </div>
    <!-- работа с формой -->
    <div>
        <form>
            <label for="tasckdata">Выберите приоритет задачи</label></br>
                <select name="tasckdata" id="tasckdata">

                </select>

        </form>

    </div>
</div>
<div>
    <footer>Alex debil</footer>
</div>
 <div class="task-board">
            <div class="column" id="queue">
                <h2 class="text-center text-light">В очереди</h2>
                {% for task in tasks_by_section['В очереди'] %}
                <div class="task" data-id="{{ task.task_id }}">
                    <h5>{{ task.content }}</h5>
                    <p>{{ task.description }}</p>
                </div>
                {% endfor %}
            </div>
            <div class="column" id="in-progress">
                <h2 class="text-center text-light">В работе</h2>
                {% for task in tasks_by_section['В работе'] %}
                <div class="task" data-id="{{ task.task_id }}">
                    <h5>{{ task.content }}</h5>
                    <p>{{ task.description }}</p>
                </div>
                {% endfor %}
            </div>
            <div class="column" id="done">
                <h2 class="text-center text-light">Готово</h2>
                {% for task in tasks_by_section['Готово'] %}
                <div class="task" data-id="{{ task.task_id }}">
                    <h5>{{ task.content }}</h5>
                    <p>{{ task.description }}</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <script>
        function updateTaskStatus(taskId, newStatus) {
            fetch('/update_task_status', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ task_id: taskId, status: newStatus })
            }).then(response => response.json()).then(data => {
                if (data.error) {
                    alert("Ошибка при обновлении статуса задачи: " + data.error);
                }
            }).catch(error => {
                alert("Ошибка при обновлении статуса задачи: " + error);
            });
        }

        function addTaskToColumn(taskId, content, description, columnId) {
            const taskDiv = document.createElement('div');
            taskDiv.className = 'task';
            taskDiv.setAttribute('data-id', taskId);
            taskDiv.innerHTML = `<h5>${content}</h5><p>${description}</p>`;
            document.getElementById(columnId).appendChild(taskDiv);
        }

        document.getElementById('taskForm').addEventListener('submit', function(event) {
            event.preventDefault();

            const taskContent = document.getElementById('task_content').value;
            const priority = document.getElementById('priority').value;
            const description = document.getElementById('description').value;
            const customer = document.getElementById('customer').value;
            const department = document.getElementById('department').value;

            fetch('/create_task', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    task_content: taskContent,
                    priority: priority,
                    description: description,
                    customer: customer,
                    department: department
                })
            }).then(response => response.json()).then(data => {
                if (data.error) {
                    alert("Ошибка при создании задачи: " + data.error);
                } else {
                    addTaskToColumn(data.task_id, data.content, description, 'queue');
                    document.getElementById('taskForm').reset();
                }
            }).catch(error => {
                alert("Ошибка при создании задачи: " + error);
            });
        });

        var queueSortable = new Sortable(document.getElementById('queue'), {
            group: 'tasks',
            onAdd: function (evt) {
                updateTaskStatus(evt.item.getAttribute('data-id'), 'В очереди');
            }
        });

        var inProgressSortable = new Sortable(document.getElementById('in-progress'), {
            group: 'tasks',
            onAdd: function (evt) {
                updateTaskStatus(evt.item.getAttribute('data-id'), 'В работе');
            }
        });

        var doneSortable = new Sortable(document.getElementById('done'), {
            group: 'tasks',
            onAdd: function (evt) {
                updateTaskStatus(evt.item.getAttribute('data-id'), 'Готово');
            }
        });
    </script>

</body>
</html>